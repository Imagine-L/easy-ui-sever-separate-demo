{"ast":null,"code":"// 导入创建路由和路由模式的方法\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { actions, route_white_list, session } from \"@/constant\";\nimport store from \"@/store\";\nimport storage from \"@/utils/storage\";\nimport { checkToken } from \"@/api/user\";\nimport { ElMessage } from \"element-plus\"; // 定义路由信息\n\nlet routes = [{\n  name: 'login',\n  path: '/login',\n  component: () => import('@/components/login')\n}, {\n  name: 'main',\n  path: '/main',\n  component: () => import('@/components/main'),\n  children: [{\n    name: 'user',\n    path: 'user',\n    component: () => import('@/components/system/user')\n  }, {\n    name: 'role',\n    path: 'role',\n    component: () => import('@/components/system/role')\n  }]\n}]; // 创建路由实例并传递 `routes` 配置\n// 使用的路由模式是html5的，而不是hash，url中不含#\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n}); // 全局的路由守卫，可以在路由进入前做一些工作\n\nrouter.beforeEach((to, from) => {\n  // 获取目的路由名字\n  let routeName = to.name; // 是否需要放行\n\n  if (route_white_list.includes(routeName)) return true;\n  console.log(\"执行before\"); // 检查是否登录，登录则放行\n\n  console.log(store.state.user.token);\n\n  if (!store.getters.isLogin) {\n    if (storage.sessionKeyIsEmpty(session.SESSION_USER_TAG)) {\n      // 尝试从session中恢复数据\n      store.dispatch(actions.RESTORE).catch(error => {\n        store.dispatch(actions.EMPTY);\n        ElMessage.error('身份认证失效，请重新登录');\n        router.push({\n          name: 'login'\n        });\n      });\n    } else {\n      router.push({\n        name: 'login'\n      });\n      return true;\n    }\n  }\n\n  store.dispatch(actions.GET_USER_INFO); // 未登录则登录\n\n  return true;\n}); // 导出路由实例\n\nexport default router;","map":{"version":3,"sources":["E:/学习/项目/元动力ssm小项目/website-ui/src/route/index.js"],"names":["createRouter","createWebHistory","actions","route_white_list","session","store","storage","checkToken","ElMessage","routes","name","path","component","children","router","history","beforeEach","to","from","routeName","includes","console","log","state","user","token","getters","isLogin","sessionKeyIsEmpty","SESSION_USER_TAG","dispatch","RESTORE","catch","error","EMPTY","push","GET_USER_INFO"],"mappings":"AAAA;AACA,SAAQA,YAAR,EAAsBC,gBAAtB,QAA6C,YAA7C;AACA,SAAQC,OAAR,EAAiBC,gBAAjB,EAAmCC,OAAnC,QAAiD,YAAjD;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,OAAP,MAAoB,iBAApB;AACA,SAAQC,UAAR,QAAyB,YAAzB;AACA,SAAQC,SAAR,QAAwB,cAAxB,C,CAGA;;AACA,IAAIC,MAAM,GAAG,CACT;AACIC,EAAAA,IAAI,EAAE,OADV;AAEIC,EAAAA,IAAI,EAAE,QAFV;AAGIC,EAAAA,SAAS,EAAE,MAAM,OAAO,oBAAP;AAHrB,CADS,EAMT;AACIF,EAAAA,IAAI,EAAE,MADV;AAEIC,EAAAA,IAAI,EAAE,OAFV;AAGIC,EAAAA,SAAS,EAAE,MAAM,OAAO,mBAAP,CAHrB;AAIIC,EAAAA,QAAQ,EAAE,CACN;AACIH,IAAAA,IAAI,EAAE,MADV;AAEIC,IAAAA,IAAI,EAAE,MAFV;AAGIC,IAAAA,SAAS,EAAE,MAAM,OAAO,0BAAP;AAHrB,GADM,EAMN;AACIF,IAAAA,IAAI,EAAE,MADV;AAEIC,IAAAA,IAAI,EAAE,MAFV;AAGIC,IAAAA,SAAS,EAAE,MAAM,OAAO,0BAAP;AAHrB,GANM;AAJd,CANS,CAAb,C,CA0BA;AACA;;AACA,MAAME,MAAM,GAAGd,YAAY,CAAC;AACxBe,EAAAA,OAAO,EAAEd,gBAAgB,EADD;AAExBQ,EAAAA;AAFwB,CAAD,CAA3B,C,CAKA;;AACAK,MAAM,CAACE,UAAP,CAAkB,CAACC,EAAD,EAAKC,IAAL,KAAc;AAC5B;AACA,MAAIC,SAAS,GAAGF,EAAE,CAACP,IAAnB,CAF4B,CAG5B;;AACA,MAAIP,gBAAgB,CAACiB,QAAjB,CAA0BD,SAA1B,CAAJ,EAA0C,OAAO,IAAP;AAE1CE,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAN4B,CAO5B;;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYjB,KAAK,CAACkB,KAAN,CAAYC,IAAZ,CAAiBC,KAA7B;;AACA,MAAI,CAACpB,KAAK,CAACqB,OAAN,CAAcC,OAAnB,EAA4B;AACxB,QAAIrB,OAAO,CAACsB,iBAAR,CAA0BxB,OAAO,CAACyB,gBAAlC,CAAJ,EAAyD;AACrD;AACAxB,MAAAA,KAAK,CAACyB,QAAN,CAAe5B,OAAO,CAAC6B,OAAvB,EAAgCC,KAAhC,CAAsCC,KAAK,IAAI;AAC3C5B,QAAAA,KAAK,CAACyB,QAAN,CAAe5B,OAAO,CAACgC,KAAvB;AACA1B,QAAAA,SAAS,CAACyB,KAAV,CAAgB,cAAhB;AACAnB,QAAAA,MAAM,CAACqB,IAAP,CAAY;AAACzB,UAAAA,IAAI,EAAE;AAAP,SAAZ;AACH,OAJD;AAKH,KAPD,MAOO;AACHI,MAAAA,MAAM,CAACqB,IAAP,CAAY;AAACzB,QAAAA,IAAI,EAAE;AAAP,OAAZ;AACA,aAAO,IAAP;AACH;AACJ;;AAEDL,EAAAA,KAAK,CAACyB,QAAN,CAAe5B,OAAO,CAACkC,aAAvB,EAvB4B,CAwB5B;;AACA,SAAO,IAAP;AACH,CA1BD,E,CA4BA;;AACA,eAAetB,MAAf","sourcesContent":["// 导入创建路由和路由模式的方法\r\nimport {createRouter, createWebHistory} from \"vue-router\";\r\nimport {actions, route_white_list, session} from \"@/constant\";\r\nimport store from \"@/store\";\r\nimport storage from \"@/utils/storage\";\r\nimport {checkToken} from \"@/api/user\";\r\nimport {ElMessage} from \"element-plus\";\r\n\r\n\r\n// 定义路由信息\r\nlet routes = [\r\n    {\r\n        name: 'login',\r\n        path: '/login',\r\n        component: () => import('@/components/login')\r\n    },\r\n    {\r\n        name: 'main',\r\n        path: '/main',\r\n        component: () => import('@/components/main'),\r\n        children: [\r\n            {\r\n                name: 'user',\r\n                path: 'user',\r\n                component: () => import('@/components/system/user')\r\n            },\r\n            {\r\n                name: 'role',\r\n                path: 'role',\r\n                component: () => import('@/components/system/role')\r\n            },\r\n        ]\r\n    }\r\n\r\n]\r\n\r\n// 创建路由实例并传递 `routes` 配置\r\n// 使用的路由模式是html5的，而不是hash，url中不含#\r\nconst router = createRouter({\r\n    history: createWebHistory(),\r\n    routes\r\n})\r\n\r\n// 全局的路由守卫，可以在路由进入前做一些工作\r\nrouter.beforeEach((to, from) => {\r\n    // 获取目的路由名字\r\n    let routeName = to.name\r\n    // 是否需要放行\r\n    if (route_white_list.includes(routeName)) return true\r\n\r\n    console.log(\"执行before\")\r\n    // 检查是否登录，登录则放行\r\n    console.log(store.state.user.token)\r\n    if (!store.getters.isLogin) {\r\n        if (storage.sessionKeyIsEmpty(session.SESSION_USER_TAG)) {\r\n            // 尝试从session中恢复数据\r\n            store.dispatch(actions.RESTORE).catch(error => {\r\n                store.dispatch(actions.EMPTY)\r\n                ElMessage.error('身份认证失效，请重新登录')\r\n                router.push({name: 'login'})\r\n            })\r\n        } else {\r\n            router.push({name: 'login'})\r\n            return true\r\n        }\r\n    }\r\n\r\n    store.dispatch(actions.GET_USER_INFO)\r\n    // 未登录则登录\r\n    return true\r\n})\r\n\r\n// 导出路由实例\r\nexport default router"]},"metadata":{},"sourceType":"module"}